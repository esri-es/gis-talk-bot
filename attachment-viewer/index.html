<!DOCTYPE html>
<!-- To run the current sample code in your own environment, copy this to an html page. -->

<html>
<head>
  <script src="//code.jquery.com/jquery-1.12.4.min.js"></script>
  <base href="//www.jsviews.com/samples/" />
  <script src="../download/jsrender.min.js"></script>
  <link href="samples.css" rel="stylesheet" />

</head>
<body>

<ul id="result"></ul>

<script id="theTmpl" type="text/x-jsrender">
<li>

      <img src="{{:url}}" data-parentobjectid="{{:parentObjectId}}" onclick="showImage({{:parentObjectId}})">

</li>
</script>

<script>

var template = $.templates("#theTmpl");




//var featureUrl = 'https://services.arcgis.com/0ZRg6WRC7mxSLyKX/arcgis/rest/services/harveyDamagePhotos/FeatureServer/0';
//var featureUrl = 'http://services2.arcgis.com/lakDP2oKmBnm3KDC/ArcGIS/rest/services/Prueba_20140804_061021/FeatureServer/0';
var featureUrl = 'https://services.arcgis.com/nzS0F0zdNLvs7nc8/arcgis/rest/services/NPSMemories/FeatureServer/0'
var objectIdField = null;

$.getJSON( `${featureUrl}?f=json`, function( data ) {
    objectIdField = data.objectIdField
});

$.getJSON( `${featureUrl}/queryAttachments?objectIds=&globalIds=&definitionExpression=1+%3D+1&attachmentTypes=&size=&resultOffset=&resultRecordCount=&f=pjson&token=`, function( data ) {
    var attachments = [],
        attachments_thumb = [];
    data.attachmentGroups.forEach(function(elem,i){
        elem.attachmentInfos.forEach(function(attachment,j){
            var tmp = `${featureUrl}/${elem.parentObjectId}/attachments/${attachment.id}`;
            console.log(tmp);
            if(j !== 0){
                attachments.push({
                    parentObjectId: elem.parentObjectId,
                    GlobalID: attachment.GlobalID,
                    url: tmp
                });
            }else{

                attachments_thumb.push({
                    parentObjectId: elem.parentObjectId,
                    GlobalID: attachment.GlobalID,
                    url: tmp
                });
            }
        });
    });


    var htmlOutput = template.render(attachments_thumb);
    $("#result").html(htmlOutput);

});

function showImage(id){




var feature = `${featureUrl}/query?where=${objectIdField}+%3D+${id}&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&resultType=none&distance=0.0&units=esriSRUnit_Meter&returnGeodetic=false&outFields=*&returnGeometry=true&multipatchOption=xyFootprint&maxAllowableOffset=&geometryPrecision=&outSR=4326&datumTransformation=&applyVCSProjection=false&returnIdsOnly=false&returnCountOnly=false&returnExtentOnly=false&returnDistinctValues=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&having=&resultOffset=&resultRecordCount=&returnZ=false&returnM=false&returnExceededLimitFeatures=true&quantizationParameters=&sqlFormat=none&f=json&token=`;
    console.log(feature)
}


</script>

</body>
</html>
